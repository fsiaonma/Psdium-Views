var console=console||{log:function(e){PV.Config.DEBUG?$.writeln(e):alert(e)}};var PV=PsdiumViews={},PVQ=PV.QuarkJs={};PV.Base=function(){return{walk:function(e,t){for(var n=e.length-1;n>-1;--n){var r=e[n].name.substr(0,e[n].name.indexOf("_"));t&&t(e[n],r)}},getExName:function(e){return e.substr(0,e.indexOf("_"))},getComponentName:function(e){var t=e.substr(0,e.indexOf("_")),n=e;for(var r in PV.Global.QUARKJS.ELEMENT)t==PV.Global.QUARKJS.ELEMENT[r]&&(n=e.substr(e.indexOf("_")+1));return n}}}();PV.Config=function(){return{DEBUG:!0,LIB_MODE:{QUARKJS:{SOURCE_PATH:{SLICE:"/d/Github/Psdium-Views/demo/ui_slice/",POS:"/d/Github/Psdium-Views/demo/ui_pos/"},EXPORT_PATH:{SLICE:"/c/wamp/www/workplace/testPSD2V/scripts/configs/",POS:"/c/wamp/www/workplace/testPSD2V/scripts/views/",IMAGE:"/c/wamp/www/workplace/testPSD2V/images/"}}}}}();PV.Global=function(){return{ART_LAYER:"ArtLayer",LAYER_SET:"LayerSet",LIB_MODE:{QUARKJS:"QUARKJS"},QUARKJS:{VIEW:"View",ELEMENT:{IMAGE:"Image",BUTTON:"Button",TEXT:"Text",CONTAINER:"Container",TOGGLE_BUTTON:"ToggleButton",SWITCH:"Switch",INPUT:"Input",ANIMATION:"Ani",DRAGPANEL:"DragPanel",ITEM:"Item"},BUTTON_STATUS:{UP:"up",DOWN:"down",DISABLE:"disable"},TOGGLE_BUTTON_STATUS:{UP:"up",DOWN:"down",DISABLE:"disable",CHECK_UP:"checkup",CHECK_DOWN:"checkdown",CHECK_DISABLE:"checkdisable"},SWITCH_STATUS:{BG:"bg",UP:"up",DOWN:"down"},Input_STATUS:{AREA:"area",TEXT:"text"},DRAGPANEL_STATUS:{AREA:"area"}}}}();PVQ.processSliceFile=function(){var e=function(e){var t=File(PV.Config.LIB_MODE.QUARKJS.EXPORT_PATH.SLICE+"Slice.js");t.exists?(t.encoding="utf-8",t.open("e:"),t.seek(0,2)):(t=new File(PV.Config.LIB_MODE.QUARKJS.EXPORT_PATH.SLICE+"Slice.js"),t.encoding="utf-8",t.open("e:"),t.writeln("Slice = window.Slice || {};")),t.writeln("");var n="",r=e.name.substr(0,e.name.indexOf("."));t.writeln("Slice['"+r+".png'] = {"),function(e){for(var r=0,i=e.length;r<i;++r){var s=e[r];if(s.typename==PV.Global.ART_LAYER){n!=""&&t.write(",\n");var o=s.name,u=Math.round(s.bounds[0]),a=Math.round(s.bounds[1]),f=Math.round(s.bounds[2])-u,l=Math.round(s.bounds[3])-a;n="	'"+o+"':["+u+", "+a+", "+f+", "+l+"]",t.write(n)}else s.typename==PV.Global.LAYER_SET&&arguments.callee(s.layers)}}(e.layers),t.writeln("\n};"),t.close()},t=function(e){var t=new PNGSaveOptions,n=e.name.substr(0,e.name.indexOf("."));e.saveAs(new File(PV.Config.LIB_MODE.QUARKJS.EXPORT_PATH.IMAGE+n+".png"),t)};return function(n){e(n),t(n)}}();PVQ.processPosFile=function(){return function(e){var t=e.name.indexOf("_")+1,n=e.name.substr(t)+"V",r=new File(PV.Config.LIB_MODE.QUARKJS.EXPORT_PATH.POS+n+".js");r.encoding="utf-8",r.open("w:"),r.writeln("var "+n+" = G.Container.getClass().extend({\n"+"	init:function(){\n\n"+"		this._super(arguments);\n"),PV.Base.walk(e.layers,function(e,t){PVQ.dispatcher.processElements(r,e,t)}),r.writeln("	}"),r.writeln("});"),r.close()}}();PVQ.BaseH=function(){this.getParent=function(e){var t,n,r=e.parent,i=r.name.substr(0,r.name.indexOf("_"));return i==PV.Global.QUARKJS.ELEMENT.CONTAINER||i==PV.Global.QUARKJS.ELEMENT.ITEM?(n=PV.Base.getComponentName(r.name),t=[Math.round(r.bounds[0]),Math.round(r.bounds[1])]):(n="this",t=[0,0]),{pos:t,name:n}},this.getConfig=function(e,t){var n=PV.Base.getComponentName(e.name),r=Math.round(e.bounds[0]),i=Math.round(e.bounds[1]);r-=t.pos[0],i-=t.pos[1];var s=Math.round(e.bounds[2])-r,o=Math.round(e.bounds[3])-i,u=e.visible?!0:!1;return{name:n,pos:[r,i,s,o],visible:u}}};PVQ.ImageH=function(){this.describe=function(e,t){var n=this;(function(t){var r=arguments.callee;PV.Base.walk(t.layers,function(t,i){var s=t;if(s.typename==PV.Global.ART_LAYER){var o=n.getParent(s),u=n.getConfig(s,o),a="		var "+u.name+" = G.Image.create({slice: G.getSlice('"+u.name+"')});\n"+"		"+u.name+".setVisible("+u.visible+");\n"+"		"+u.name+".setPos(["+u.pos+"]);\n"+"		"+o.name+".addChild("+u.name+");\n"+"		"+o.name+"."+u.name+" = "+u.name+";\n";e.writeln(a)}else PV.Base.getExName(s.name)==PV.Global.QUARKJS.ELEMENT.IMAGE&&s.typename==PV.Global.LAYER_SET&&r(s)})})(t)}},PVQ.ImageH.prototype=new PVQ.BaseH;PVQ.ButtonH=function(){this.describe=function(e,t){var n=this.getParent(t),r=this.getConfig(t,n),i,s,o;for(var u=0,a=t.layers.length;u<a;++u){var f=t.layers[u],l=f.name;switch(l){case PV.Global.QUARKJS.BUTTON_STATUS.UP:f.layers&&f.layers.length>0&&(i=f.layers[0].name);break;case PV.Global.QUARKJS.BUTTON_STATUS.DOWN:f.layers&&f.layers.length>0&&(s=f.layers[0].name);break;case PV.Global.QUARKJS.BUTTON_STATUS.DISABLE:f.layers&&f.layers.length>0&&(o=f.layers[0].name)}}var c="",h={imgUp:"",imgDown:"",imgDisable:""};i&&(h.imgUp="			imgUp: G.getSlice('"+i+"')",c="imgUp"),s&&(h[c]+=",\n",h.imgDown="			imgDown: G.getSlice('"+s+"')",c="imgDown"),o&&(h[c]+=",\n",h.imgDisable=o?"			,imgDisable: G.getSlice('"+o+"')\n":"",c="imgDisable");var p="		var "+r.name+" = G.Button.create({\n"+h.imgUp+h.imgDown+h.imgDisable+"\n"+"		});\n"+"		"+r.name+".setVisible("+r.visible+");\n"+"		"+r.name+".setPos(["+r.pos+"]);\n"+"		"+n.name+".addChild("+r.name+");\n"+"		"+n.name+"."+r.name+" = "+r.name+";\n";e.writeln(p)}},PVQ.ButtonH.prototype=new PVQ.BaseH;PVQ.TextH=function(){this.describe=function(e,t){var n=PV.Base.getComponentName(t.name),r=t.layers[0],i=this.getParent(t),s=this.getConfig(r,i),o=r.textItem,u=Math.round(o.size),a=Math.round(o.leading),f=o.justification.toString().split(".")[1].toLowerCase(),l=o.color.rgb.hexValue,c=o.contents.replace(/\r/gi,""),h="		var "+n+" = G.Text.create();\n"+"		"+n+".setPos(["+s.pos+"]);\n"+"		"+n+".setFontSize("+u+");\n"+"		"+n+".setWidth("+s.pos[2]+");\n"+"		"+n+".setLineHeight("+a+");\n"+"		"+n+".setColor('#"+l+"');\n"+"		"+n+".setTextAlign('"+f+"');\n"+"		"+n+".setText('"+c+"');\n"+"		"+n+".setVisible("+s.visible+");\n"+"		"+i.name+".addChild("+n+");\n"+"		"+i.name+"."+n+" = "+n+";\n";e.writeln(h)}},PVQ.TextH.prototype=new PVQ.BaseH;PVQ.ToggleButtonH=function(){this.describe=function(e,t){var n=this.getParent(t),r=this.getConfig(t,n),i,s,o,u,a,f;for(var l=0,c=t.layers.length;l<c;++l){var h=t.layers[l],p=h.name;switch(p){case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.UP:h.layers&&h.layers.length>0&&(i=h.layers[0].name);break;case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.DOWN:h.layers&&h.layers.length>0&&(s=h.layers[0].name);break;case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.DISABLE:h.layers&&h.layers.length>0&&(o=h.layers[0].name);break;case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.CHECK_UP:h.layers&&h.layers.length>0&&(u=h.layers[0].name);break;case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.CHECK_DOWN:h.layers&&h.layers.length>0&&(a=h.layers[0].name);break;case PV.Global.QUARKJS.TOGGLE_BUTTON_STATUS.CHECK_DISABLE:h.layers&&h.layers.length>0&&(f=h.layers[0].name)}}var d="",v={imgUp:"",imgDown:"",imgDisable:"",checkedImgUp:"",checkedImgDown:"",checkedImgDisable:""};i&&(v.imgUp="			imgUp: G.getSlice('"+i+"')",d="imgUp"),s&&(v[d]+=",\n",v.imgDown="			imgDown: G.getSlice('"+s+"')",d="imgDown"),o&&(v[d]+=",\n",v.imgDisable=o?"			imgDisable: G.getSlice('"+o+"')\n":"",d="imgDisable"),u&&(v[d]+=",\n",v.checkedImgUp="			checkedImgUp: G.getSlice('"+u+"')",d="checkedImgUp"),a&&(v[d]+=",\n",v.checkedImgDown="			checkedImgDown: G.getSlice('"+a+"')",d="checkedImgDown"),f&&(v[d]+=",\n",v.checkedImgDisable=f?"			checkedImgDisable: G.getSlice('"+f+"')":"",d="checkedImgDisable");var m="		var "+r.name+" = G.ToggleButton.create({\n"+v.imgUp+v.imgDown+v.imgDisable+v.checkedImgUp+v.checkedImgDown+v.checkedImgDisable+"\n"+"		});\n"+"		"+r.name+".setVisible("+r.visible+");\n"+"		"+r.name+".setPos(["+r.pos+"]);\n"+"		"+n.name+".addChild("+r.name+");\n"+"		"+n.name+"."+r.name+" = "+r.name+";\n";e.writeln(m)}},PVQ.ToggleButtonH.prototype=new PVQ.BaseH;PVQ.SwitchH=function(){this.describe=function(e,t){var n=this.getParent(t),r=this.getConfig(t,n),i,s,o;for(var u=0,a=t.layers.length;u<a;++u){var f=t.layers[u],l=f.name;switch(l){case PV.Global.QUARKJS.SWITCH_STATUS.BG:f.layers&&f.layers.length>0&&(i=f.layers[0].name);break;case PV.Global.QUARKJS.SWITCH_STATUS.UP:f.layers&&f.layers.length>0&&(s=f.layers[0].name);break;case PV.Global.QUARKJS.SWITCH_STATUS.DOWN:f.layers&&f.layers.length>0&&(o=f.layers[0].name)}}var c="",h={bg:"",upBar:"",downBar:""};i&&(h.bg="			bg: G.getSlice('"+i+"')",c="bg"),s&&(h[c]+=",\n",h.upBar="			upBar: G.getSlice('"+s+"')",c="upBar"),o&&(h[c]+=",\n",h.downBar="			downBar: G.getSlice('"+o+"')",c="downBar");var p="		var "+r.name+" = G.Switch.create({\n"+"			width: "+r.pos[2]+",\n"+h.bg+h.upBar+h.downBar+"\n"+"		});\n"+"		"+r.name+".setVisible("+r.visible+");\n"+"		"+r.name+".setPos(["+r.pos+"]);\n"+"		"+n.name+".addChild("+r.name+");\n"+"		"+n.name+"."+r.name+" = "+r.name+";\n";e.writeln(p)}},PVQ.SwitchH.prototype=new PVQ.BaseH;PVQ.InputH=function(){this.describe=function(e,t){var n,r,i,s;for(var o=0,u=t.layers.length;o<u;++o)if(t.layers[o].name==PV.Global.QUARKJS.Input_STATUS.AREA){var a=t.layers[o];r=this.getParent(a),n=this.getConfig(a,r)}else if(t.layers[o].name==PV.Global.QUARKJS.Input_STATUS.TEXT){var f=t.layers[o].textItem;i=Math.round(f.size),s=Math.round(f.leading)}var l=PV.Base.getComponentName(t.name),c=l+"Container",h="		var "+c+" = G.Container.create();\n"+"		"+c+".setPos(["+n.pos+"]);\n"+"		"+r.name+".addChild("+c+");\n"+"		var "+l+" = G.Input.create();\n"+"		"+l+".setWidth("+n.pos[2]+");\n"+"		"+l+".setHeight("+n.pos[3]+");\n"+"		"+l+".setLineHeight("+s+");\n"+"		"+l+".setFontSize("+i+");\n"+"		"+l+".setVisible("+n.visible+");\n"+"		"+c+".addChild("+l+");\n"+"		"+r.name+"."+l+" = "+l+";\n"+"		"+r.name+"."+c+" = "+c+";\n";e.writeln(h)}},PVQ.InputH.prototype=new PVQ.BaseH;PVQ.AnimationH=function(){this.describe=function(e,t){var n=this.getParent(t),r=this.getConfig(t,n),i=t.layers,s="",o="[";for(var u=0,a=i.length;u<a;++u)s!=""&&(o+=","),s="\n				G.Action.create({slice: G.getSlice('"+i[u].name+"')})",o+=s;o+="\n			]";var f="		var "+r.name+" = G.Animation.create({\n			actions: "+o+"\n		});\n"+"		"+r.name+".setVisible("+r.visible+");\n"+"		"+r.name+".setPos(["+r.pos+"]);\n"+"		"+n.name+".addChild("+r.name+");\n"+"		"+n.name+"."+r.name+" = "+r.name+";\n";e.writeln(f)}},PVQ.AnimationH.prototype=new PVQ.BaseH;PVQ.ContainerH=function(){this.describe=function(e,t){var n=this.getParent(t),r=this.getConfig(t,n),i="		var "+r.name+" = G.Container.create();\n"+"		"+r.name+".setVisible("+r.visible+");\n"+"		"+r.name+".setPos(["+r.pos+"]);\n"+"		"+n.name+".addChild("+r.name+");\n"+"		"+n.name+"."+r.name+" = "+r.name+";\n";e.writeln(i),PV.Base.walk(t.layers,function(t,n){PVQ.dispatcher.processElements(e,t,n)})}},PVQ.ContainerH.prototype=new PVQ.BaseH;PVQ.DragPanelH=function(){this.describe=function(e,t){var n,r,s,o=this;PV.Base.walk(t.layers,function(u,a){if(u.name==PV.Global.QUARKJS.DRAGPANEL_STATUS.AREA){var f=t.layers[i];r=o.getParent(f),n=o.getConfig(f,r)}else if(PV.Base.getExName(u.name)==PV.Global.QUARKJS.ELEMENT.ITEM){s=PV.Base.getComponentName(u.name);var l="		var "+s+" = G.Container.create();\n";e.writeln(l),PV.Base.walk(u.layers,function(t,n){PVQ.dispatcher.processElements(e,t,n)})}});var u=PV.Base.getComponentName(t.name),a=u+"Container",f="		var "+a+" = G.Container.create();\n"+"		var "+u+" = G.DragPanel.create();\n"+"		"+u+".setWidth("+n.pos[2]+");\n"+"		"+u+".setHeight("+n.pos[3]+");\n"+"		"+u+".setVisible("+n.visible+");\n"+"		"+u+".setPos(["+n.pos+"]);\n"+"		"+u+".setContent("+a+");\n"+"		"+r.name+".addChild("+u+");\n"+"		"+a+".addChild("+s+");\n"+"		"+r.name+"."+u+" = "+u+";\n"+"		"+r.name+"."+a+" = "+a+";\n"+"		"+r.name+"."+s+" = "+s+";\n";e.writeln(f)}},PVQ.DragPanelH.prototype=new PVQ.BaseH;PVQ.dispatcher=function(){var e=null,t=null,n=null,r=null,i=null,s=null,o=null,u=null,a=null;return{processDoc:function(){if(PV.Config.LIB_MODE.QUARKJS.SOURCE_PATH.SLICE){var e=Folder(PV.Config.LIB_MODE.QUARKJS.SOURCE_PATH.SLICE),t=File.decode(e.getFiles()).split(",");for(var n=0,r=t.length;n<r;++n){var i=open(File(t[n]));PVQ.processSliceFile(i),i.close()}}if(PV.Config.LIB_MODE.QUARKJS.SOURCE_PATH.POS){var s=Folder(PV.Config.LIB_MODE.QUARKJS.SOURCE_PATH.POS),t=File.decode(s.getFiles()).split(",");for(var n=0,r=t.length;n<r;++n){var i=open(File(t[n]));PV.Base.walk(i.layers,function(e,t){t==PV.Global.QUARKJS.VIEW&&PVQ.processPosFile(e)}),i.close()}}},processElements:function(f,l,c){switch(c){case PV.Global.QUARKJS.ELEMENT.BUTTON:t||(t=new PVQ.ButtonH),t.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.IMAGE:e||(e=new PVQ.ImageH),e.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.TEXT:n||(n=new PVQ.TextH),n.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.CONTAINER:r||(r=new PVQ.ContainerH),r.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.TOGGLE_BUTTON:i||(i=new PVQ.ToggleButtonH),i.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.SWITCH:s||(s=new PVQ.SwitchH),s.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.INPUT:o||(o=new PVQ.InputH),o.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.ANIMATION:u||(u=new PVQ.AnimationH),u.describe(f,l);break;case PV.Global.QUARKJS.ELEMENT.DRAGPANEL:a||(a=new PVQ.DragPanelH),a.describe(f,l);break;default:console.log("找不到类型: "+c+", 图层名: "+l.name)}}}}();PVQ.main=function(){return function(e){var t=File(PV.Config.LIB_MODE.QUARKJS.EXPORT_PATH.SLICE+"Slice.js");t.exists&&t.remove(),PVQ.dispatcher.processDoc()}}();PV.dispatcher=function(){return{expoortLibMode:function(e,t){switch(e){case PV.Global.LIB_MODE.QUARKJS:PVQ.main(t)}}}}();(function(e){e.preferences.rulerUnits=Units.PIXELS,e.preferences.typeUnits=TypeUnits.PIXELS,displayDialogs=DialogModes.NO;for(var t in PV.Config.LIB_MODE)e&&PV.dispatcher.expoortLibMode(t,e)})(app);